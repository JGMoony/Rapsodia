{% extends "base.html" %}
{% load static %}

{% block title %}Disponibilidad{% endblock %}

{% block content %}
    <h1>Consultar Disponibilidad de Mesas</h1>

    <form method="post"class="form">
        {% csrf_token %}
        {{ form.as_p }}
        <button name="consultar">Consultar Disponibilidad</button>
    </form>

    {% if mesas_disponibles %}
        <h2>
            Mesas Disponibles para {{ fecha }} a las {{ hora }} 
            ({{ personas }} personas)
        </h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Mesa #</th>
                    <th>Capacidad</th>
                    <th>Acci√≥n</th>
                </tr>
            </thead>
            <tbody>
                {% for mesa in mesas_disponibles %}
                    <tr>
                        <td>{{ mesa.numero }}</td>
                        <td>{{ mesa.capacidad }}</td>
                        <td>
                            <form method="post" class="form">
                                {% csrf_token %}
                                <input type="hidden" name="fecha" value="{{ fecha|date:'Y-m-d' }}">
                                <input type="hidden" name="hora" value="{{ hora }}">
                                <input type="hidden" name="personas" value="{{ personas }}">
                                <input type="hidden" name="mesa_id" value="{{ mesa.id }}">
                                <button type="submit" name="reservar">Reservar</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No se encontraron mesas disponibles que cumplan con los requisitos.</p>
    {% endif %}

    {% if reserva_confirmada %}
        <div class="alert-success">
            <h3>Reserva Confirmada</h3>
            <p>Cliente: {{ reserva_confirmada.cliente.nombre }}</p>
            <p>Mesa: {{ reserva_confirmada.mesa.numero }} 
                (Capacidad: {{ reserva_confirmada.mesa.capacidad }})</p>
            <p>Fecha: {{ reserva_confirmada.fecha }}</p>
            <p>Hora: {{ reserva_confirmada.hora }}</p>
            <p>Personas: {{ reserva_confirmada.personas }}</p>
        </div>
    {% endif %}
{% endblock %}
